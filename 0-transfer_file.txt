#!/usr/bin/env bash
# Transfers a file to a remote server user's home directory using scp (non-interactive)

# Exit on any error, treat unset vars as error, and propagate errors in pipelines
set -euo pipefail

usage() {
  echo "Usage: 0-transfer_file PATH_TO_FILE IP USERNAME PATH_TO_SSH_KEY"
}

# Check args
if [ "$#" -lt 4 ]; then
  usage
  exit 1
fi

file_path="$1"
ip_addr="$2"
username="$3"
ssh_key_path="$4"

# Basic validations
if [ ! -f "$file_path" ]; then
  echo "Error: file '$file_path' not found" >&2
  exit 1
fi

if [ ! -f "$ssh_key_path" ]; then
  echo "Error: SSH key '$ssh_key_path' not found" >&2
  exit 1
fi

# Transfer the file to the remote user's home directory (~)
# -o StrictHostKeyChecking=no disables host key checking (non-interactive)
# -o UserKnownHostsFile=/dev/null prevents adding it to known_hosts
# -i "$ssh_key_path" uses the provided private key
scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -i "$ssh_key_path" "$file_path" "$username"@"$ip_addr":~/

# Print a success message with remote path
echo "File '$file_path' copied to $username@$ip_addr:~/"
